<!DOCTYPE html>
<html>
<script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
<!-- we import arjs version without NFT but with marker + location based support -->
<script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
<script>
    var rooms = [
        "Pontio", {
            name: "Bar",
            maxCap: 15,
            currentCap: 15
        }, {
            name: "Cinema",
            maxCap: 50,
            currentCap: 0
        }, {
            name: "Lecture Room",
            maxCap: 25,
            currentCap: 1
        }, {
            name: "Meeting Room",
            maxCap: 10,
            currentCap: 7
        }
    ]

    var outerBoxSpec = {
        height: 1,
        width: .25,
        depth: .25,
        wireFrameWidth: 4,
        wireframeEnabled: "True",
        color: "black"
    }

    var innerBoxSpec = {
        height: 0,
        width: .20,
        depth: .20,
        wireFrameWidth: 0,
        wireframeEnabled: "False",
        color: "red"
    }

    AFRAME.registerComponent('build', { // Remeber to call the Method in an entity parameters 
        init: function() {
            background = document.querySelector("a-plane"); // Select the background

            var numOfObjects = rooms.length; // Find number of objects
            bkHeight = numOfObjects + (numOfObjects * .15);
            background.setAttribute('height', bkHeight)

            var c = 0;
            var spacing = bkHeight / numOfObjects;
            var y = spacing * (numOfObjects / 2);

            for (x in rooms) {
                var el = document.createElement('a-entity');

                if (c == 0) { //Create & Postion title
                    el.setAttribute('id', "title");
                    el.setAttribute('text', {
                        value: rooms[0] + " Room Capacity Checker",
                        color: "black"
                    });
                    el.setAttribute('position', "0.75 " + (y - (y * .1)) + " 0.1");
                    el.setAttribute('scale', "4 4 1");

                } else {
                    // Calculating the current capcity of the room (Height of the InnerBox) #########################################
                    var currentCap = rooms[c].currentCap;
                    if (currentCap <= 0) { // Room is empty
                        currentCap = .001;
                    } else if (currentCap >= rooms[c].maxCap) { // Room is full
                        currentCap = outerBoxSpec.height;
                    } else {
                        currentCap = currentCap / rooms[c].maxCap; // Room is neither empty nor full
                    }
                    innerBoxSpec.height = currentCap;

                    // Calculating the Y pos of the Innerbox based on the height
                    var offSet = (1 - currentCap) / 2;
                    offSet = offSet - (offSet * 2); // Sign Reversal


                    // Outer Box defintion #########################################
                    // Attributes
                    el.setAttribute('id', rooms[c].name);
                    el.setAttribute('geometry', {
                        primitive: 'box',
                        height: outerBoxSpec.height,
                        width: outerBoxSpec.width,
                        depth: outerBoxSpec.depth,
                    });
                    // Apperance
                    el.setAttribute('material', {
                        color: outerBoxSpec.color,
                        wireframe: outerBoxSpec.wireframeEnabled
                    });
                    // Position
                    el.setAttribute('position', {
                        x: -1,
                        y: y,
                        z: .25
                    });


                    // Inner Box defintion #########################################
                    var capIndicator = document.createElement('a-entity');
                    // Attributes
                    capIndicator.setAttribute('geometry', {
                        primitive: 'box',
                        height: innerBoxSpec.height,
                        width: innerBoxSpec.width,
                        depth: innerBoxSpec.depth,
                    });
                    // Apperance
                    capIndicator.setAttribute('material', {
                        color: innerBoxSpec.color,
                    });
                    // Position
                    capIndicator.setAttribute('position', {
                        x: -1,
                        y: offSet + y,
                        z: .25
                    });

                    // Room headers #########################################
                    var roomHeader = document.createElement('a-entity');
                    roomHeader.setAttribute('id', rooms[c].name + "Header");
                    roomHeader.setAttribute('text', {
                        value: rooms[c].name + "\n" + rooms[c].currentCap + "/" + rooms[c].maxCap,
                        color: "black"
                    });
                    roomHeader.setAttribute('position', ".5 " + y + " 0.1");
                    roomHeader.setAttribute('scale', "2.5 2.5 1");

                    background.appendChild(roomHeader);
                    background.appendChild(capIndicator);
                }
                background.appendChild(el);
                c++;
                y = y - spacing;
            }
        }
    });

    AFRAME.registerComponent('log', {
        schema: {
            type: 'string'
        },

        init: function() {
            var stringToLog = this.data;
            console.log(stringToLog);
        }
    });
</script>

<body style="margin : 0px; overflow: hidden;">
    <a-scene embedded arjs>
        <a-marker id="marker" preset="hiro">
            <!--BackGround-->
            <a-plane log="Hello Plane!" build id="background" color="grey" width="4" height="4.5" rotation="-90 0 0" opacity="0.5" transparent="true"></a-plane>
        </a-marker>
        <a-entity camera></a-entity>
    </a-scene>
</body>

</html>