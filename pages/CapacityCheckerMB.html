<!DOCTYPE html>
<html>
<script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
<!-- we import arjs version without NFT but with marker + location based support -->
<script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
<script>
    var room = {
        name: "cafe",
        maxCap: 30,
        currentCap: 20
    }

    var outerBoxSpec = {
        height: 1,
        width: .25,
        depth: .25,
        wireFrameWidth: 4,
        wireframeEnabled: "True",
        color: "black"
    }

    var innerBoxSpec = {
        height: 0,
        width: .20,
        depth: .20,
        wireFrameWidth: 0,
        wireframeEnabled: "False",
        color: "red"
    }


    AFRAME.registerComponent('log', {
        schema: {
            type: 'string'
        },

        init: function() {
            var stringToLog = this.data;
            console.log(stringToLog);

            sceneEl = document.querySelector("a-plane");

            var curCap = room.currentCap / room.maxCap

            var outerHeight = outerBox.getAttribute('height')
            var y = (outerHeight - curCap) / 2
            y = y - (y * 2) // Sign Reversal
            var innerPos = "0 " + String(y) + " 0"

            innerBox.setAttribute('height', curCap)
            innerBox.setAttribute('position', innerPos)

            // __________ Outer Box creation__________ 
            var outerBoxEl = document.createElement('a-entity');
            outerBoxEl.setAttribute('do-something-once-loaded', '');

            // Attributes
            outerBoxEl.setAttribute('id', "testOuter")
            outerBoxEl.setAttribute('geometry', {
                primitive: 'box',
                height: outerBoxSpec.height,
                width: outerBoxSpec.width,
                depth: outerBoxSpec.depth,
                position: "0 0 .25"
            });

            // Apperance
            outerBoxEl.setAttribute('material', {
                color: outerBoxSpec.color,
                wireframe: outerBoxSpec.wireframeEnabled
            });

            // Position
            outerBoxEl.setAttribute('position', {
                x: 0,
                y: 0,
                z: .25
            })

            // __________ Inner Box creation__________ 
            var innerBoxEl = document.createElement('a-entity');
            innerBoxEl.setAttribute('do-something-once-loaded', '');

            // Attributes
            innerBoxEl.setAttribute('geometry', {
                primitive: 'box',
                height: curCap,
                width: innerBoxSpec.width,
                depth: innerBoxSpec.depth,
                position: "0 0 .25"
            });

            // Apperance
            innerBoxEl.setAttribute('material', {
                color: innerBoxSpec.color,
            });

            // Position
            innerBoxEl.setAttribute('position',
                innerPos
            )


            // Adding Boxes to the scene
            sceneEl.appendChild(outerBoxEl);
            testOuter.appendChild(innerBoxEl);
        }
    });

    AFRAME.registerComponent('do-something-once-loaded', {
        init: function() {
            // This will be called after the entity has properly attached and loaded.
            console.log('I am ready!');
        }
    });
</script>

<body style="margin : 0px; overflow: hidden;">
    <a-scene embedded arjs>
        <a-marker preset="hiro">
            <!--BackGround-->
            <a-plane id="bkGround" color="grey" height="5" width="5" rotation="-90 0 0">
                <a-entity text="value: Pontio; color: black;" position="0 0 .1" scale="2 2 1"></a-entity>
                <!--Box Objects-->
                <a-box id="outerBox" log="Hello, Box" color="black" depth=".25" height="1" width="0.24" position="1 0 .25" wireframe="true" wireframe-linewidth="4">
                    <a-box id="innerBox" color="red" depth=".20" height=".1" width="0.20" position="0 -.25 0"></a-box>
                    <a-entity text="value: Hello Box; color: black;" position="-.25 0 0" scale="2 2 1">
                    </a-entity>

                </a-box>
            </a-plane>
        </a-marker>
        <a-entity camera></a-entity>
    </a-scene>
</body>

</html>